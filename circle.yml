machine:
  environment:
    MAPCODE: 150302
dependencies:
  pre:
    - mkdir -p ~/assets/binmaps/
    - find  ~/assets/
    - sudo apt-get update
    - sudo apt-get install cmake 
    - sudo apt-get install libpng12-dev 
#    - sudo apt-get install libgtk2.0-dev 
    - sudo apt-get install librsvg2-bin 
    - sudo apt-get install g++
    - ls -la ~/navit
    - bash ci/build.sh
#    - wget -c -O ~/planet-${MAPCODE}.osm.bz2 ftp://ftp.spline.de/pub/openstreetmap/planet/2015/planet-${MAPCODE}.osm.bz2
#    - wget -c -O  ~/europe-latest-complete.osm.pbf http://ftp.snt.utwente.nl/pub/misc/openstreetmap/europe-latest.osm.pbf
#    - wget -c -O  ~/europe-latest.osm.pbf http://ftp.snt.utwente.nl/pub/misc/openstreetmap/europe-latest.osm.pbf
#    - wget http://m.m.i24.cc/osmconvert.c && gcc osmconvert.c -lz -o osmconvert
    - wget -c -O ~/europe-heightlines.zip https://dl.dropboxusercontent.com/u/93775123/Navit/europe-heightlines.zip
    - unzip ~/europe-heightlines.zip -d ~/
#    - wget -c -O ~/CA-incomplete.heightlines.zip https://dl.dropboxusercontent.com/u/93775123/Navit/CA-incomplete.heightlines.zip
#    - unzip ~/CA-incomplete.heightlines.zip -d ~/
  cache_directories:
    - "~/assets/"
test:
  post:
#    - ./osmconvert -h
    - ls -la /home/ubuntu/navit
    - ls -la /home/ubuntu
    - ./bin/navit/maptool/maptool -i ~/europe-heightlines.osm $CIRCLE_ARTIFACTS/europe.heightlines.bin:
        timeout: 7200
#    - ./bin/navit/maptool/maptool -i ~/CA-incomplete.heightlines.osm $CIRCLE_ARTIFACTS/CA-incomplete.heightlines.bin:
#        timeout: 7200
    
    - ls -la /home/ubuntu
    - ls -la $CIRCLE_ARTIFACTS
    
general:
  artifacts:
    - "~/assets/binmaps/"
