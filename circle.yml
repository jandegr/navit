machine:
  environment:
    MAPCODE: 150302
dependencies:
  pre:
    - mkdir -p ~/assets/binmaps/
    - find  ~/assets/
    - sudo apt-get update
    - sudo apt-get install cmake 
    - sudo apt-get install libpng12-dev 
#    - sudo apt-get install libgtk2.0-dev 
    - sudo apt-get install librsvg2-bin 
    - sudo apt-get install g++
    - ls -la ~/navit
    - bash ci/build.sh
#    - wget -c -O ~/planet-${MAPCODE}.osm.bz2 ftp://ftp.spline.de/pub/openstreetmap/planet/2015/planet-${MAPCODE}.osm.bz2
    - wget -c -O  ~/europe-latest-complete.osm.pbf http://ftp.snt.utwente.nl/pub/misc/openstreetmap/europe-latest.osm.pbf
#    - wget -c -O  ~/europe-latest.osm.pbf http://ftp.snt.utwente.nl/pub/misc/openstreetmap/europe-latest.osm.pbf
    - wget http://m.m.i24.cc/osmconvert.c && gcc osmconvert.c -lz -o osmconvert
  cache_directories:
    - "~/assets/"
test:
  post:
#    - ./osmconvert -h
    - ls -la /home/ubuntu/navit
    - ./osmconvert --complete-ways --drop-author --verbose ~/europe-latest-complete.osm.pbf -B=/home/ubuntu/navit/BFR.poly -o=/home/ubuntu/europe-latest.osm.pbf:
        timeout: 7200
    - ls -la /home/ubuntu
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s1 -e1 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin:
        timeout: 7200
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s2 -e2 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s3 -e3 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s4 -e4 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s5 -e5 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s6 -e6 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin:
       timeout: 7200
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s7 -e7 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s8 -e8 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s9 -e9 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s10 -e10 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ./bin/navit/maptool/maptool -P  -6 -n -k -s11 -r /home/ubuntu/navit/rulefile_combined.txt -i ~/europe-latest.osm.pbf $CIRCLE_ARTIFACTS/BFR.bin
    - ls -la /home/ubuntu
    - cp tilesdir_.tmp $CIRCLE_ARTIFACTS
    - ls -la /home/ubuntu
    - ls -la $CIRCLE_ARTIFACTS
general:
  artifacts:
    - "~/assets/binmaps/"
